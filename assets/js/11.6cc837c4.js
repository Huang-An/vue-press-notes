(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{514:function(a,s,e){a.exports=e.p+"assets/img/img-01-01.534dd84d.jpg"},515:function(a,s,e){a.exports=e.p+"assets/img/img-01-02.fb1e6772.jpg"},528:function(a,s,e){"use strict";e.r(s);var t=e(6),p=Object(t.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("现有个 webpack.config.js 如下：")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("module"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  mode"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'development'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n  entry"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'./src/index.js'")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("执行命令")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("webpack --config scripts/webpack.config.js\n")])])]),t("h3",{attrs:{id:"执行命令过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行命令过程"}},[a._v("#")]),a._v(" 执行命令过程")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("通过 shell 运行的脚本，通常会寻找模块的 package 中的 bin 字段作为程序启动的入口。")])]),a._v(" "),t("li",[t("p",[a._v("如果非通过 npx 或 package scripts 运行，会寻找 npm global 安装的 webpack，默认可在 "),t("code",[a._v("C:\\Users\\xx\\AppData\\Roaming\\npm\\node_modules\\webpack")]),a._v(" 中找到。")])]),a._v(" "),t("li",[t("p",[a._v("而通过 npx 或 package scripts 运行, 则会寻找当前目录下的 node_modules 的 webpack。")])]),a._v(" "),t("li",[t("p",[a._v("执行命令后，运行 "),t("code",[a._v("webpack/bin/webpack.js")]),a._v("。")])])]),a._v(" "),t("p",[t("code",[a._v("webpack/bin/webpack.js")]),a._v(" 中会调用 cli，对终端传入的参数进行解析。")]),a._v(" "),t("p",[a._v("允许 "),t("code",[a._v("webpack-cli")]),a._v(" 或者 "),t("code",[a._v("webpack-command")]),a._v("。只会寻找其中一个进行执行。如果两个都安装了，会抛出警告，并停止后续的执行。")]),a._v(" "),t("p",[a._v("其中判断是否安装了 "),t("code",[a._v("webpack-cli")]),a._v(" 或者 "),t("code",[a._v("webpack-command")]),a._v("。是通过 require.resolve 查询某个模块文件的带有完整绝对路径的文件名，如果捕获到异常就是没有安装。")]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[a._v("isInstalled")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("packageName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("try")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    require"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("resolve")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("packageName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("catch")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("如果都没有安装，则会通过 readLine 在终端中询问是否安装 "),t("code",[a._v("webpack-cli")]),a._v("，如果允许，则通过 "),t("code",[a._v("runCommand")]),a._v(" 安装 "),t("code",[a._v("webpack-cli")])]),a._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[a._v("最终通过 require "),t("code",[a._v("webpack-cli")]),a._v(" 或者 "),t("code",[a._v("webpack-command")]),a._v("， 调用 cli。")])]),a._v(" "),t("h3",{attrs:{id:"webpack-cli"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webpack-cli"}},[a._v("#")]),a._v(" webpack-cli")]),a._v(" "),t("p",[t("code",[a._v("webpack-cli")]),a._v(" 的程序入口是 "),t("code",[a._v("webpack-cli/bin/cli")]),a._v("，其是一个立即执行函数，会在被 webpack require 后，立即执行。")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("调用 "),t("code",[a._v("import-local")]),a._v(" 判断当前目录是否安装了 "),t("code",[a._v("webpack-cli")]),a._v("，如果是，则优先使用当前目录的 "),t("code",[a._v("webpack-cli")]),a._v("。")])]),a._v(" "),t("li",[t("p",[a._v("引入 "),t("code",[a._v("v8-compile-cache")]),a._v(" 进行编译缓存。")])]),a._v(" "),t("li",[t("p",[a._v("通过 "),t("code",[a._v("yargs")]),a._v(" 对终端参数进行解析。")])]),a._v(" "),t("li",[t("p",[a._v("在 "),t("code",[a._v('require("./utils/convert-argv")')]),a._v(" 中，处理终端选项，请求 "),t("code",[a._v("webpack.config.js")]),a._v("，并合并两者的选项参数。")])]),a._v(" "),t("li",[t("p",[a._v("处理完参数之后，引入 "),t("code",[a._v("webpack")]),a._v(", 这里的 webpack 是运行主入口文件，即 package 中的 main 字段："),t("code",[a._v("webpack/lib/webpack.js")]),a._v("。 传入参数，并执行。同时在 webpack 方法返回的 compiler 对象上，通过 "),t("code",[a._v("hooks.watchRun.tap")]),a._v(" 和 "),t("code",[a._v("hooks.beforeRun.tap")]),a._v(" 订阅事件，等待触发时，打印一些日志。")])]),a._v(" "),t("li",[t("p",[a._v("调用 compiler 对象中的 run 方法开始执行本次编译。在 compiler.close 之后，执行编译结束的回调，在回调中，如果需要生成 stats，即生成。")])])]),a._v(" "),t("h3",{attrs:{id:"webpack-lib-webpack-js"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webpack-lib-webpack-js"}},[a._v("#")]),a._v(" webpack/lib/webpack.js")]),a._v(" "),t("p",[a._v("在 "),t("code",[a._v("webpack-cli")]),a._v(" 中执行了 "),t("code",[a._v("webpack")]),a._v(" 方法并传入选项之后。"),t("code",[a._v("webpack/lib/webpack.js")]),a._v(" 会调用 "),t("code",[a._v("validateSchema")]),a._v(" 方法对选项参数进行校验。然后通过 new Compiler() 创建一个编译对象。（这里如果参数选项是一个数组，会创建多个 compiler）。")]),a._v(" "),t("p",[t("img",{attrs:{src:e(514),alt:"img-01-01"}})]),a._v(" "),t("ol",[t("li",[t("p",[a._v("在创建完 "),t("code",[a._v("compiler")]),a._v(" 之后，会挂载 "),t("code",[a._v("NodeEnvironmentPlugin")]),a._v("，这个插件主要是封装一些读取文件，生成文件，监听文件的一些方法，大部分都是 node 文件系统的一些 api。")])]),a._v(" "),t("li",[t("p",[a._v("执行在选项中配置的 plugins，诸如 "),t("code",[a._v("webpack-html-plugin")]),a._v("。")])])]),a._v(" "),t("p",[t("img",{attrs:{src:e(515),alt:"img-01-02"}})]),a._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[a._v("之后，会根据选项配置，挂载一些内置的 "),t("code",[a._v("plugin")]),a._v("，诸如 "),t("code",[a._v("ExternalsPlugin")]),a._v("、"),t("code",[a._v("CommonJsPlugin")])])]),a._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("options "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WebpackOptionsApply")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("process")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" compiler"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"title"}),t("p",[a._v("webpack 中的插件，通常是一个类，拥有一个 "),t("code",[a._v("apply")]),a._v(" 方法。也可以是一个函数，在调用时会将通过 call 方法，将上下文指向 "),t("code",[a._v("compiler")]),a._v("，并接受 "),t("code",[a._v("compiler")]),a._v(" 对象作为参数。在插件中通过向 hooks 中订阅事件，等待在编译过程中被触发。")])])])}),[],!1,null,null,null);s.default=p.exports}}]);